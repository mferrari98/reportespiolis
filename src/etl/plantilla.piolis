<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportespiolis</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/plotly-latest.min.js"></script>
</head>

<style>
:root {
  --mi-variable-global: #3498db; /* Color azul */
  font-family: 'Courier New';
}

h2 {
    text-align: center;
}

table {
  margin: 25px auto;
  border-collapse: collapse;
  border: 1px solid #eee;
  border-bottom: 2px solid var(--mi-variable-global);
  box-shadow: 0px 0px 20px rgba(0,0,0,0.10),
     0px 10px 20px rgba(0,0,0,0.05),
     0px 20px 20px rgba(0,0,0,0.05),
     0px 30px 20px rgba(0,0,0,0.05);
  
  tr {
     &:hover {
      background: #d1cdcd;
      
      td {
        color: var(--mi-variable-global);
      }
    }
  }
  
  th, td {
    color: #000000;
    border: 1px solid #bebebe;
    padding: 12px 35px;
    border-collapse: collapse;
    text-align: center; 
  }
  #sit {
    text-align: left
  }
  
  th {
    background: var(--mi-variable-global);
    color: #fff;
    text-transform: uppercase;
    font-size: 16px;
    &.last {
      border-right: none;
    }
  }
}
</style>

<body>
    <h2>Reporte horario</h2>
    <div>
        <table>
            <thead>
                <tr>
                    <th>Sitio</th>
                    <th><!-- HEADER_0 --></th>
                    <th><!-- HEADER_1 --></th>
                    <th><!-- HEADER_2 --></th>
                    <th><!-- HEADER_3 --></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="sit"><!-- SITIO_0 --></td>
                    <td><!-- NIVEL_0 --></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_1 --></td>
                    <td><!-- NIVEL_1 --></td>
                    <td></td>
                    <td><!-- TURB_1 --></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_2 --></td>
                    <td><!-- NIVEL_2 --></td>
                    <td><!-- CLORO_2 --></td>
                    <td><!-- TURB_2 --></td>
                    <td><!-- VOLDIA_2 --></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_3 --></td>
                    <td><!-- NIVEL_3 --></td>
                    <td><!-- CLORO_3 --></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_4 --></td>
                    <td><!-- NIVEL_4 --></td>
                    <td><!-- CLORO_4 --></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_5 --></td>
                    <td><!-- NIVEL_5 --></td>
                    <td><!-- CLORO_5 --></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_6 --></td>
                    <td><!-- NIVEL_6 --></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_7 --></td>
                    <td><!-- NIVEL_7 --></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_8 --></td>
                    <td><!-- NIVEL_8 --></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td id="sit"><!-- SITIO_9 --></td>
                    <td><!-- NIVEL_9 --></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Div donde se renderizará el gráfico -->
    <div id="myDiv" style="width: 100%; height: 500px;"></div>
    <button id="guardar">Guardar como imagen</button>

    <script>
        // Datos de la tabla
        var sitios = [<!-- SITIOS -->];
        var niveles = [<!-- NIVELES -->];
        const miVariableGlobal = getComputedStyle(document.documentElement).getPropertyValue('--mi-variable-global');
        
        var trace1 = {
            x: sitios,
            y: niveles,
            name: 'Nivel',
            type: 'bar',
            marker: {
                color: `${miVariableGlobal}`,
            },
            text: niveles.map(String),
            textposition: 'auto',
            hoverinfo: 'none',
        };

        var trace2 = {
            x: sitios,
            y: [<!-- COMPLEMENTO -->],
            name: 'Rebalse',
            type: 'bar',
            marker: {
                color: '${var(--mi-variable-global)}',
                opacity: 0.3
            },
            text: [<!-- REBALSE -->].map(String),
            textposition: 'auto',
            hoverinfo: 'none',
        };

        var data = [trace1, trace2];

        // Configurar el diseño del gráfico
        var layout = {
            barmode: 'stack',
            title: 'Niveles de Agua por Sitio',
            xaxis: {
                title: 'Sitio'
            },
            yaxis: {
                title: 'Nivel [m]'
            },
            dragmode: false,  // Esto deshabilita el modo de arrastre para el zoom
            zoom: false,  // Esto deshabilita completamente la funcionalidad de zoom
            autosize: true,
            font: {
          family: 'Courier New',
          size: 16
        }
        };
        var config = {responsive: true};

        // Renderizar el gráfico en el div con id 'myDiv'
        Plotly.newPlot('myDiv', data, layout, config, {displayModeBar: false});

        document.getElementById('guardar').onclick = function() {
            Plotly.toImage(document.getElementById('myDiv'), { format: 'png'})
                .then(function(url) {
                    // Convertir la imagen a base64
                    var base64Image = url.split(',')[1];

                    // Enviar la imagen al servidor
                    fetch('/imagenpt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ image: base64Image })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Éxito:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
                })
                .catch(function(error) {
                    console.error('Error al crear la imagen:', error);
                });
        };
    </script>
</body>
</html>