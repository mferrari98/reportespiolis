<!-- template.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportespiolis</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/plotly-latest.min.js"></script>
</head>
<body>
    <h2>Estado de reservas</h2>
    <div>
        <table>
            <thead>
                <tr>
                    <th>Sitio</th>
                    <th>Nivel[m]</th>
                    <th>Cloro[mlg/l]</th>
                    <th>Turbiedad[UTN]</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Toma(Rio)</td>
                    <td>1.91</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Toma(Des.)</td>
                    <td>2.33</td>
                    <td></td>
                    <td>10.63</td>
                </tr>
                <tr>
                    <td>P.Pot</td>
                    <td>1.86</td>
                    <td>1.28</td>
                    <td>0.13</td>
                </tr>
                <tr>
                    <td>L.Maria</td>
                    <td>3.10</td>
                    <td>1.22</td>
                    <td></td>
                </tr>
                <tr>
                    <td>KM11</td>
                    <td>3.75</td>
                    <td>0.69</td>
                    <td></td>
                </tr>
                <tr>
                    <td>R6000</td>
                    <td>3.34</td>
                    <td>0.56</td>
                    <td></td>
                </tr>
                <tr>
                    <td>B.PUJOL</td>
                    <td>2.01</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>B.OESTE(1K)</td>
                    <td>1.46</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>B.SAN MIGUEL</td>
                    <td>2.25</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>NUEVA CHUBUT</td>
                    <td>2.93</td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Div donde se renderizará el gráfico -->
    <div id="myDiv" style="width: 100%; height: 500px;"></div>
    <button id="guardar">Guardar como imagen</button>

    <script>
        // Datos de la tabla
        var sitios = ['Toma(Rio)', 'Toma(Des.)', 'P.Pot', 'L.Maria', 'KM11', 'R6000', 'B.PUJOL', 'B.OESTE(1K)', 'B.SAN MIGUEL', 'NUEVA CHUBUT', 'PLANTA POT.'];
        var niveles = ['1.91', '2.33', '1.86', '3.10', '3.75', '3.34', '2.01', '1.46', '2.25', '2.93'];

        var trace1 = {
            x: sitios,
            y: niveles,
            name: 'Nivel',
            type: 'bar',
            marker: {
                color: '#2E3A8B',
            }
        };

        var trace2 = {
            x: sitios,
            y: [2.09, 0.6699999999999999, 1.14, 1.9, 1.25, 0.6600000000000001, 0.9900000000000002, 3.54, 1.5499999999999998, 1.0699999999999998],
            name: 'Rebalse',
            type: 'bar',
            marker: {
                color: '#2E3A8B',
                opacity: 0.3
            }
        };

        var data = [trace1, trace2];

        // Configurar el diseño del gráfico
        var layout = {
            barmode: 'stack',
            title: 'Niveles de Agua por Sitio',
            xaxis: {
                title: 'Sitio'
            },
            yaxis: {
                title: 'Nivel [m]'
            },
            dragmode: false,  // Esto deshabilita el modo de arrastre para el zoom
            zoom: false  // Esto deshabilita completamente la funcionalidad de zoom
        };

        // Renderizar el gráfico en el div con id 'myDiv'
        Plotly.newPlot('myDiv', data, layout, {displayModeBar: false});

        document.getElementById('guardar').onclick = function() {
            Plotly.toImage(document.getElementById('myDiv'), { format: 'png'})
                .then(function(url) {
                    // Convertir la imagen a base64
                    var base64Image = url.split(',')[1];

                    // Enviar la imagen al servidor
                    fetch('/imagenpt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ image: base64Image })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Éxito:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
                })
                .catch(function(error) {
                    console.error('Error al crear la imagen:', error);
                });
        };
    </script>
</body>
</html>