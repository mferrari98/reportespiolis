<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reportespiolis</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/plotly-latest.min.js"></script>
  </head>

  <style>
    :root {
      --mi-variable-global: #3498db; /* Color azul */
      font-family: "Courier New";
    }

    h2 {
      text-align: center;
    }

    table {
      margin: 25px auto;
      border-collapse: collapse;
      border: 1px solid #eee;
      border-bottom: 2px solid var(--mi-variable-global);
      box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1),
        0px 10px 20px rgba(0, 0, 0, 0.05), 0px 20px 20px rgba(0, 0, 0, 0.05),
        0px 30px 20px rgba(0, 0, 0, 0.05);

      tr {
        &:hover {
          background: #d1cdcd;

          td {
            color: var(--mi-variable-global);
          }
        }
      }

      th,
      td {
        color: #000000;
        border: 1px solid #bebebe;
        padding: 12px 35px;
        border-collapse: collapse;
        text-align: center;
      }
      #sit {
        text-align: left;
      }

      th {
        background: var(--mi-variable-global);
        color: #fff;
        text-transform: uppercase;
        font-size: 16px;
        &.last {
          border-right: none;
        }
      }
    }
  </style>

  <body>
    <h2>Reporte horario</h2>
    <div>
      <table>
        <thead>
          <tr>
            <th>Sitio</th>
            <th>Nivel[m]</th>
            <th>...</th>
            <th>...</th>
            <th>...</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="sit">Toma(Des.)</td>
            <td>2.15</td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">L.Maria</td>
            <td>1.3</td>
            <td></td>
            <td><!-- TURB_1 --></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">B.OESTE(1K)</td>
            <td>3.25</td>
            <td><!-- CLORO_2 --></td>
            <td><!-- TURB_2 --></td>
            <td><!-- VOLDIA_2 --></td>
          </tr>
          <tr>
            <td id="sit">NUEVA CHUBUT</td>
            <td>3.11</td>
            <td><!-- CLORO_3 --></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">R6000</td>
            <td>3.12</td>
            <td><!-- CLORO_4 --></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">P.Pot</td>
            <td>2.37</td>
            <td><!-- CLORO_5 --></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">B.PUJOL</td>
            <td>2.48</td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">KM11</td>
            <td>3.72</td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">Toma(Rio)</td>
            <td>3.3</td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td id="sit">B.SAN MIGUEL</td>
            <td>2.36</td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Div donde se renderizará el gráfico -->
    <div id="myDiv" style="width: 100%; height: 500px"></div>
    <button id="guardar">Guardar como imagen</button>
    <script>
      // Datos de la tabla
      var sitios = [
        "Toma(Des.)",
        "L.Maria",
        "B.OESTE(1K)",
        "NUEVA CHUBUT",
        "R6000",
        "P.Pot",
        "B.PUJOL",
        "KM11",
        "Toma(Rio)",
        "B.SAN MIGUEL",
      ];
      var niveles = [2.15, 1.3, 3.25, 3.11, 3.12, 2.37, 2.48, 3.72, 3.3, 2.36];
      const miVariableGlobal = getComputedStyle(
        document.documentElement
      ).getPropertyValue("--mi-variable-global");

      var trace1 = {
        x: sitios,
        y: niveles,
        name: "Nivel",
        type: "bar",
        marker: {
          color: `${miVariableGlobal}`,
        },
        text: niveles.map(String),
        textposition: "auto",
        hoverinfo: "none",
      };

      var trace2 = {
        x: sitios,
        y: [0.85, 3.7, 1.75, 0.89, 0.88, 0.63, 0.52, 1.28, 0.7, 1.44],
        name: "Rebalse",
        type: "bar",
        marker: {
          color: "${var(--mi-variable-global)}",
          opacity: 0.3,
        },
        text: [3.0, 5.0, 5.0, 4.0, 4.0, 3.0, 3.0, 5.0, 4.0, 3.8].map(String),
        textposition: "auto",
        hoverinfo: "none",
      };

      var data = [trace1, trace2];

      // Configurar el diseño del gráfico
      var layout = {
        barmode: "stack",
        title: "Niveles de Agua por Sitio",
        xaxis: {
          title: "Sitio",
        },
        yaxis: {
          title: "Nivel [m]",
        },
        dragmode: false, // Esto deshabilita el modo de arrastre para el zoom
        zoom: false, // Esto deshabilita completamente la funcionalidad de zoom
        autosize: true,
        font: {
          family: "Courier New",
          size: 16,
        },
      };
      var config = { responsive: true };

      // Renderizar el gráfico en el div con id 'myDiv'
      Plotly.newPlot("myDiv", data, layout, config, { displayModeBar: false });

      document.getElementById("guardar").onclick = function () {
        Plotly.toImage(document.getElementById("myDiv"), { format: "png" })
          .then(function (url) {
            // Convertir la imagen a base64
            var base64Image = url.split(",")[1];

            // Enviar la imagen al servidor
            fetch("/imagenpt", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ image: base64Image }),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Éxito:", data);
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          })
          .catch(function (error) {
            console.error("Error al crear la imagen:", error);
          });
      };
    </script>
  </body>
</html>
